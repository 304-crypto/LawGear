<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Law Gear: ë¨¸ë‹ˆì‚¬ì´íŠ¸ ë¹Œë“œì—… ë¡œë“œë§µ (Pacemaker Edition)</title>
    <!-- íŒŒë¹„ì½˜ ì¶”ê°€: ì¸ë””ê³  ìƒ‰ìƒ ì €ìš¸ ì•„ì´ì½˜ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234F46E5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z'/><path d='m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z'/><path d='M7 21h10'/><path d='M12 3v18'/><path d='M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #0f172a; }
        
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .card-hover { transition: all 0.2s ease-in-out; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        /* Roadmap Line */
        .roadmap-line { position: absolute; left: 24px; top: 0; bottom: 0; width: 2px; background: #e2e8f0; z-index: 0; }
        .roadmap-item { position: relative; z-index: 1; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .progress-ring__circle { transition: stroke-dashoffset 0.35s; transform: rotate(-90deg); transform-origin: 50% 50%; }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-slate-50">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 px-4 lg:px-8 h-16 flex items-center justify-between card-shadow">
        <div class="flex items-center gap-3">
            <!-- ë¡œê³  ì•„ì´ì½˜ ë³€ê²½ (íŒŒë¹„ì½˜ê³¼ í†µì¼ê° ìˆê²Œ FontAwesome ì•„ì´ì½˜ ì‚¬ìš©) -->
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-md">
                <i class="fa-solid fa-scale-balanced"></i>
            </div>
            <h1 class="text-xl font-bold text-slate-800 hidden md:block">Law Gear <span class="text-indigo-600">Pacemaker</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="hidden md:flex items-center gap-2 text-sm font-medium text-slate-600">
                <span>ì§„í–‰ë¥ :</span>
                <div class="w-32 h-2.5 bg-slate-200 rounded-full overflow-hidden">
                    <div id="globalProgressBar" class="h-full bg-indigo-500 rounded-full" style="width: 0%"></div>
                </div>
                <span id="globalProgressText" class="text-indigo-600 font-bold">0%</span>
            </div>
            <button onclick="switchView('roadmap')" class="nav-btn bg-indigo-50 text-indigo-700 px-4 py-2 rounded-lg font-bold text-sm hover:bg-indigo-100 transition-colors">
                <i class="fa-solid fa-map mr-2"></i> ë¡œë“œë§µ
            </button>
            <button onclick="switchView('library')" class="nav-btn text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-lg font-medium text-sm transition-colors">
                <i class="fa-solid fa-list mr-1"></i> ì „ì²´ ëª©ë¡
            </button>
            <button onclick="switchView('settings')" class="nav-btn text-slate-400 hover:text-slate-600 px-2 py-2 transition-colors">
                <i class="fa-solid fa-gear"></i>
            </button>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto w-full p-4 lg:p-8">

        <!-- VIEW 1: ROADMAP (PACEMAKER) -->
        <div id="roadmap-view" class="space-y-8 animate-fade-in">
            
            <!-- Hero Section: Current Status -->
            <div class="bg-gradient-to-r from-indigo-900 to-slate-800 rounded-2xl p-6 md:p-10 text-white shadow-xl flex flex-col md:flex-row items-center justify-between gap-8">
                <div class="flex-1 space-y-4">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-500/30 border border-indigo-400/30 text-indigo-200 text-xs font-bold uppercase tracking-wider">
                        <i class="fa-solid fa-flag-checkered"></i> Current Phase
                    </div>
                    <h2 id="currentPhaseTitle" class="text-3xl md:text-4xl font-bold leading-tight">Lv.1 ê¸°ì´ˆ ê³µì‚¬ <span class="text-indigo-400">(Base)</span></h2>
                    <p id="currentPhaseDesc" class="text-slate-300 text-lg">ë¸”ë¡œê·¸ ì§€ìˆ˜ë¥¼ ìŒ“ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ê²€ìƒ‰ëŸ‰ì€ ì ì§€ë§Œ ì „í™˜ì´ ì‰¬ìš´ ìƒí™œ ë²•ë¥  í‚¤ì›Œë“œë¡œ 'ìœ íš¨íƒ€'ë¥¼ ë§Œë“œì„¸ìš”.</p>
                    <div class="flex gap-3 pt-2">
                        <div class="flex flex-col">
                            <span class="text-xs text-slate-400 uppercase">ë°œí–‰ëœ ê¸€</span>
                            <span class="text-2xl font-bold" id="totalPublishedCount">0</span>
                        </div>
                        <div class="w-px h-10 bg-slate-600 mx-2"></div>
                        <div class="flex flex-col">
                            <span class="text-xs text-slate-400 uppercase">ë‚¨ì€ í€˜ìŠ¤íŠ¸</span>
                            <span class="text-2xl font-bold text-amber-400" id="remainingCount">160</span>
                        </div>
                    </div>
                </div>
                
                <!-- Today's Mission Card -->
                <div class="w-full md:w-96 bg-white/10 backdrop-blur-md border border-white/20 rounded-xl p-5 relative group">
                    <div class="flex justify-between items-start mb-3">
                        <span class="bg-amber-500 text-white text-xs font-bold px-2 py-1 rounded shadow-sm animate-pulse">ğŸ”¥ ì¶”ì²œ: ì˜¤ëŠ˜ì˜ ê¸€ê°</span>
                        <div class="flex gap-2">
                            <!-- Telegram Button -->
                            <button onclick="sendToTelegram(event)" class="text-white hover:text-sky-400 transition-colors" title="í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì „ì†¡">
                                <i class="fa-brands fa-telegram text-2xl"></i>
                            </button>
                        </div>
                    </div>
                    <div onclick="openNextMission()" class="cursor-pointer">
                        <h3 id="nextMissionTitle" class="text-xl font-bold text-white mb-2 leading-snug">ë¡œë”©ì¤‘...</h3>
                        <p id="nextMissionHook" class="text-sm text-slate-300 line-clamp-2 italic">"ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤..."</p>
                        <div class="mt-4 pt-4 border-t border-white/10 flex justify-between items-center">
                            <span id="nextMissionLeg" class="text-xs font-medium text-indigo-200 bg-indigo-900/50 px-2 py-1 rounded">TRAFFIC</span>
                            <span class="text-xs text-amber-300 font-bold hover:underline">ì‘ì„±í•˜ëŸ¬ ê°€ê¸° &rarr;</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Roadmap Phases -->
            <div class="grid grid-cols-1 gap-8 relative pb-20">
                <!-- Line -->
                <div class="hidden md:block absolute left-8 top-8 bottom-0 w-0.5 bg-gradient-to-b from-indigo-500 via-slate-300 to-slate-100"></div>

                <!-- Phase 1 -->
                <div class="roadmap-section relative pl-0 md:pl-20">
                    <div class="hidden md:flex absolute left-0 top-0 w-16 h-16 bg-white border-4 border-indigo-500 rounded-full items-center justify-center z-10 shadow-md">
                        <span class="text-xl font-bold text-indigo-700">1</span>
                    </div>
                    <div class="mb-4 flex items-baseline gap-3">
                        <h3 class="text-2xl font-bold text-slate-800">Lv.1 ê¸°ì´ˆ ë‹¤ì§€ê¸° (Foundation)</h3>
                        <span class="text-sm text-slate-500 font-medium">ê²€ìƒ‰ ìœ ì…ì˜ ì”¨ì•—ì„ ë¿Œë¦¬ëŠ” ë‹¨ê³„ (ê¸€ 1~40)</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="phase1-grid">
                        <!-- Cards -->
                    </div>
                </div>

                <!-- Phase 2 -->
                <div class="roadmap-section relative pl-0 md:pl-20">
                    <div class="hidden md:flex absolute left-0 top-0 w-16 h-16 bg-white border-4 border-emerald-500 rounded-full items-center justify-center z-10 shadow-md">
                        <span class="text-xl font-bold text-emerald-700">2</span>
                    </div>
                    <div class="mb-4 flex items-baseline gap-3">
                        <h3 class="text-2xl font-bold text-slate-800">Lv.2 íŠ¸ë˜í”½ í­ë°œ (Expansion)</h3>
                        <span class="text-sm text-slate-500 font-medium">ì´ìŠˆì„± í‚¤ì›Œë“œë¡œ ë°©ë¬¸ìë¥¼ ëŒì–´ëª¨ìœ¼ëŠ” ë‹¨ê³„ (ê¸€ 41~80)</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="phase2-grid">
                        <!-- Cards -->
                    </div>
                </div>

                <!-- Phase 3 -->
                <div class="roadmap-section relative pl-0 md:pl-20">
                    <div class="hidden md:flex absolute left-0 top-0 w-16 h-16 bg-white border-4 border-amber-500 rounded-full items-center justify-center z-10 shadow-md">
                        <span class="text-xl font-bold text-amber-700">3</span>
                    </div>
                    <div class="mb-4 flex items-baseline gap-3">
                        <h3 class="text-2xl font-bold text-slate-800">Lv.3 ì‹ ë¢° êµ¬ì¶• (Authority)</h3>
                        <span class="text-sm text-slate-500 font-medium">ì „ë¬¸ê°€ í¬ì§€ì…”ë‹ìœ¼ë¡œ ì²´ë¥˜ì‹œê°„ì„ ëŠ˜ë¦¬ëŠ” ë‹¨ê³„ (ê¸€ 81~120)</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="phase3-grid">
                        <!-- Cards -->
                    </div>
                </div>

                <!-- Phase 4 -->
                <div class="roadmap-section relative pl-0 md:pl-20">
                    <div class="hidden md:flex absolute left-0 top-0 w-16 h-16 bg-white border-4 border-rose-500 rounded-full items-center justify-center z-10 shadow-md">
                        <span class="text-xl font-bold text-rose-700">4</span>
                    </div>
                    <div class="mb-4 flex items-baseline gap-3">
                        <h3 class="text-2xl font-bold text-slate-800">Lv.4 ìˆ˜ìµ ì‚¬ëƒ¥ (Monetization)</h3>
                        <span class="text-sm text-slate-500 font-medium">ê³ ë‹¨ê°€ CPAë¡œ ìˆ˜ìµì„ ê·¹ëŒ€í™”í•˜ëŠ” ë‹¨ê³„ (ê¸€ 121~160)</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="phase4-grid">
                        <!-- Cards -->
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 2: FULL LIBRARY (Search & Filter) -->
        <div id="library-view" class="hidden space-y-6 animate-fade-in">
            <div class="bg-white p-4 rounded-xl border border-slate-200 card-shadow sticky top-20 z-40">
                <div class="flex flex-col md:flex-row gap-4 justify-between items-center">
                    <div class="flex items-center gap-2 overflow-x-auto no-scrollbar w-full md:w-auto">
                        <button class="filter-btn active bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold shrink-0" data-filter="all">ì „ì²´ ë³´ê¸°</button>
                        <button class="filter-btn bg-white border border-slate-200 text-slate-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-slate-50 shrink-0" data-filter="unpublished">ì‘ì„± ì˜ˆì •</button>
                        <button class="filter-btn bg-white border border-slate-200 text-slate-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-slate-50 shrink-0" data-filter="published">ë°œí–‰ ì™„ë£Œ</button>
                    </div>
                    <div class="relative w-full md:w-96">
                        <input type="text" id="searchInput" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰ (ì˜ˆ: í•©ì˜ê¸ˆ, ëˆ„ìˆ˜)" class="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
                        <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400"></i>
                    </div>
                </div>
            </div>
            <div id="fullLibraryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pb-20">
                <!-- JS Populated -->
            </div>
        </div>

        <!-- VIEW 3: SETTINGS (Data Mgmt) -->
        <div id="settings-view" class="hidden space-y-8 animate-fade-in max-w-2xl mx-auto mt-10">
            <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-200 text-center">
                <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa-solid fa-database text-2xl text-slate-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ë°ì´í„° ê´€ë¦¬</h2>
                <p class="text-slate-500 mb-8">ì‘ì—… ë‚´ì—­ì„ ë°±ì—…í•˜ê±°ë‚˜ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <button onclick="exportData()" class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-200 hover:border-indigo-500 hover:bg-indigo-50 transition-all group">
                        <i class="fa-solid fa-download text-2xl text-indigo-500 mb-2 group-hover:scale-110 transition-transform"></i>
                        <span class="font-bold text-slate-700">ë°±ì—… ì €ì¥</span>
                        <span class="text-xs text-slate-400 mt-1">JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ</span>
                    </button>
                    <button onclick="document.getElementById('importFile').click()" class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-200 hover:border-emerald-500 hover:bg-emerald-50 transition-all group">
                        <i class="fa-solid fa-upload text-2xl text-emerald-500 mb-2 group-hover:scale-110 transition-transform"></i>
                        <span class="font-bold text-slate-700">ë°±ì—… ë³µì›</span>
                        <span class="text-xs text-slate-400 mt-1">JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</span>
                    </button>
                    <button onclick="resetData()" class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-200 hover:border-rose-500 hover:bg-rose-50 transition-all group">
                        <i class="fa-solid fa-trash-can text-2xl text-rose-500 mb-2 group-hover:scale-110 transition-transform"></i>
                        <span class="font-bold text-slate-700">ì´ˆê¸°í™”</span>
                        <span class="text-xs text-slate-400 mt-1">ëª¨ë“  ë°ì´í„° ì‚­ì œ</span>
                    </button>
                </div>
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
            </div>
        </div>

    </main>

    <!-- Modal (Post Detail & Register) -->
    <div id="modal" class="fixed inset-0 bg-slate-900/80 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300 flex flex-col" id="modalContent">
            
            <!-- Header -->
            <div class="relative bg-slate-800 p-6 shrink-0">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors text-xl">
                    <i class="fa-solid fa-xmark"></i>
                </button>
                <div class="flex items-center gap-2 mb-3">
                    <span id="m-leg" class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider bg-slate-700 text-white">CATEGORY</span>
                    <span id="m-phase" class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider bg-indigo-500 text-white">LV.1 BASE</span>
                </div>
                <h2 id="m-title" class="text-xl font-bold text-white leading-snug mb-4">Title Placeholder</h2>
                
                <!-- Copy Section -->
                <div class="flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-600">
                    <div class="flex-1 min-w-0">
                        <div class="text-[10px] text-slate-400 uppercase font-bold mb-0.5">Copy Format</div>
                        <div id="m-copy-text" class="text-amber-300 font-mono text-sm truncate">Title /// Keyword</div>
                    </div>
                    <button onclick="copyToClipboard('m-copy-text')" class="bg-amber-500 hover:bg-amber-400 text-indigo-900 text-xs font-bold px-3 py-2 rounded transition-colors whitespace-nowrap">
                        ë³µì‚¬ <i class="fa-regular fa-copy ml-1"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="p-6 space-y-6 overflow-y-auto">
                
                <!-- Status Toggle (The "Mark as Done" Feature) -->
                <div class="bg-slate-50 border border-slate-200 rounded-xl p-4 flex items-center justify-between">
                    <div>
                        <h4 class="text-sm font-bold text-slate-700">ë°œí–‰ ìƒíƒœ (Publish Status)</h4>
                        <p class="text-xs text-slate-500">ê¸€ì„ ë°œí–‰í–ˆë‹¤ë©´ ì²´í¬í•˜ì„¸ìš”. ì§„í–‰ë¥ ì´ ì˜¬ë¼ê°‘ë‹ˆë‹¤.</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="m-published-check" class="sr-only peer" onchange="togglePublishStatus()">
                        <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
                    </label>
                </div>

                <!-- URL Input (Visible only when checked) -->
                <div id="m-url-section" class="hidden animate-fade-in">
                    <label class="block text-xs font-bold text-slate-500 mb-1">ë°œí–‰ URL (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="m-url-input" placeholder="https://..." class="w-full bg-slate-50 border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-emerald-500 outline-none" onchange="saveUrl()">
                </div>

                <!-- Content Guide -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-1">Main Keyword</h4>
                        <p id="m-keyword" class="text-lg font-bold text-slate-800">-</p>
                    </div>
                    <div>
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-1">Hook (ì‹¬ë¦¬ íŠ¸ë¦¬ê±°)</h4>
                        <p id="m-hook" class="text-sm text-slate-600 italic border-l-2 border-amber-400 pl-3">-</p>
                    </div>
                </div>

                <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
                    <h4 class="text-indigo-700 text-sm font-bold mb-2"><i class="fa-solid fa-pen-nib mr-1"></i> ë³¸ë¬¸ ê³µëµ í¬ì¸íŠ¸</h4>
                    <p id="m-body" class="text-sm text-slate-700 leading-relaxed whitespace-pre-line">-</p>
                </div>

                <!-- Tags -->
                <div class="flex flex-wrap gap-2" id="m-seo">
                    <!-- Tags injected -->
                </div>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script>
        // --- 1. DATA GENERATION (160 High-Quality Items Strategy) ---
        // phases: 1 (Base), 2 (Traffic), 3 (Trust), 4 (Money)
        // We will generate 40 items per leg, distributed across phases.
        
        const legs = [
            { id: 'Traffic', name: 'êµí†µ/ì‚¬ê³ ', color: 'amber', icon: 'fa-car' },
            { id: 'Debt', name: 'ë¹š/íšŒìƒ', color: 'indigo', icon: 'fa-file-invoice-dollar' },
            { id: 'Housing', name: 'ì£¼ê±°/ìƒí™œ', color: 'emerald', icon: 'fa-house-chimney' },
            { id: 'Crime', name: 'ì‚¬ê¸°/ë²”ì£„', color: 'rose', icon: 'fa-user-shield' }
        ];

        // Real content templates to avoid "Traffic 35"
        const contentTemplates = {
            Traffic: [
                { t: "ë¬¸ì½•í•˜ê³  ë„ë§ê°„ ì°¨ ì¡ëŠ”ë²• CCTV í™•ë³´ë¶€í„° ê²½ì°° ì‹ ê³ ê¹Œì§€", k: "ë¬¸ì½•ë³´ìƒ", p: 1 },
                { t: "ì£¼ì°¨ì¥ ëº‘ì†Œë‹ˆ ë¬¼í”¼ë„ì£¼ ë²Œê¸ˆ 20ë§Œì›? í•©ì˜ê¸ˆ íŒ", k: "ë¬¼í”¼ë„ì£¼ì‹ ê³ ", p: 1 },
                { t: "ì´ì¤‘ì£¼ì°¨ ì°¨ ë°€ë‹¤ê°€ ì¿µ! ê³¼ì‹¤ ë¹„ìœ¨ íŒë¡€ ì´ì •ë¦¬", k: "ì´ì¤‘ì£¼ì°¨ì‚¬ê³ ", p: 1 },
                { t: "ê³ ì†ë„ë¡œ 1ì°¨ë¡œ ì •ì†ì£¼í–‰ ì‹ ê³  ë°©ë²• (ìƒí’ˆê¶Œ ë°œì†¡)", k: "ì •ì†ì£¼í–‰ì‹ ê³ ", p: 2 },
                { t: "êµí†µì‚¬ê³  í•©ì˜ìš”ë ¹ í†µì›ì¹˜ë£Œë§Œìœ¼ë¡œ 200ë§Œì› ë°›ê¸°", k: "êµí†µì‚¬ê³ í•©ì˜ê¸ˆ", p: 4 },
                { t: "12ëŒ€ ì¤‘ê³¼ì‹¤ ì‹ í˜¸ìœ„ë°˜ ì‚¬ê³  í˜•ì‚¬í•©ì˜ê¸ˆ ì‹œì„¸", k: "12ëŒ€ì¤‘ê³¼ì‹¤", p: 3 },
                { t: "ìŒì£¼ìš´ì „ ë°©ì¡°ì£„ ë™ìŠ¹ì ì²˜ë²Œ ê¸°ì¤€ê³¼ ë²Œê¸ˆ", k: "ìŒì£¼ìš´ì „ë°©ì¡°", p: 2 },
                { t: "ë¯¼ì‹ì´ë²• ìŠ¤ì¿¨ì¡´ ì‚¬ê³  ë²Œê¸ˆ 500ë§Œì› í”¼í•˜ëŠ” ë²•", k: "ë¯¼ì‹ì´ë²•", p: 3 },
                { t: "ì „ë™ í‚¥ë³´ë“œ ì‚¬ê³  ë³´í—˜ ì²˜ë¦¬ ë° í•©ì˜ê¸ˆ ê°€ì´ë“œ", k: "í‚¥ë³´ë“œì‚¬ê³ ", p: 2 },
                { t: "ìì „ê±° ì‚¬ê³  ì¼ìƒìƒí™œë°°ìƒì±…ì„ë³´í—˜ ì²˜ë¦¬ ë…¸í•˜ìš°", k: "ìì „ê±°ì‚¬ê³ ", p: 1 }
            ],
            Debt: [
                { t: "ë¹š ë…ì´‰ ì „í™” ì•ˆ ë°›ëŠ” ë²•: ë¶ˆë²•ì¶”ì‹¬ ì‹ ê³ í•˜ê³  ë³´ìƒë°›ê¸°", k: "ë¶ˆë²•ì¶”ì‹¬ëŒ€ì‘", p: 1 },
                { t: "í†µì¥ì••ë¥˜ í•´ì œ ë°©ë²•: ìµœì €ìƒê³„ë¹„ 185ë§Œì› ì§€í‚¤ê¸°", k: "í†µì¥ì••ë¥˜", p: 1 },
                { t: "ê°œì¸íšŒìƒ ì‹ ì²­ìê²©: ì›”ê¸‰ 200ë§Œì›ë„ íƒ•ê° ê°€ëŠ¥í• ê¹Œ?", k: "ê°œì¸íšŒìƒìê²©", p: 3 },
                { t: "ì£¼ì‹ ì½”ì¸ ë¹š ê°œì¸íšŒìƒ ê°€ëŠ¥í• ê¹Œ? ìµœì‹  ë²•ì› íŒë¡€", k: "ì£¼ì‹ë¹šíƒ•ê°", p: 3 },
                { t: "ê°œì¸íšŒìƒ ê¸ˆì§€ëª…ë ¹ ê¸°ê° ì‚¬ìœ ì™€ ì¬ì‹ ì²­ ì „ëµ", k: "ê¸ˆì§€ëª…ë ¹", p: 3 },
                { t: "ì •ë¶€ì§€ì› ì„œë¯¼ëŒ€ì¶œ í–‡ì‚´ë¡  ìê²© ì¡°ê±´ ë° ë¶€ê²° ëŒ€ì•ˆ", k: "í–‡ì‚´ë¡ ", p: 4 },
                { t: "ì¹´ë“œê°’ ë¦¬ë³¼ë¹™ì˜ í•¨ì •: ì‹ ìš©ë“±ê¸‰ í•˜ë½ ë§‰ëŠ” ë²•", k: "ë¦¬ë³¼ë¹™í•´ì§€", p: 2 },
                { t: "í•¸ë“œí° ìš”ê¸ˆ ë¯¸ë‚© ì‹œ ë°œì‹ ì •ì§€ì™€ ì†Œì•¡ê²°ì œ ì°¨ë‹¨", k: "í†µì‹ ì—°ì²´", p: 1 },
                { t: "ìƒì†í¬ê¸° í•œì •ìŠ¹ì¸ ì°¨ì´ì  ë° ë¹„ìš© ë¹„êµ", k: "ìƒì†í¬ê¸°", p: 2 },
                { t: "ê°œì¸íŒŒì‚° ë©´ì±… í›„ ì‹ ìš©ì¹´ë“œ ë°œê¸‰ ì‹œê¸° ì •ë¦¬", k: "ë©´ì±…í›„ì‹ ìš©ì¹´ë“œ", p: 4 }
            ],
            Housing: [
                { t: "ì¸µê°„ì†ŒìŒ ë²•ì  ê¸°ì¤€ ë°ì‹œë²¨ê³¼ ë¶„ìŸì¡°ì •ìœ„ì›íšŒ ì‹ ì²­", k: "ì¸µê°„ì†ŒìŒê¸°ì¤€", p: 1 },
                { t: "ì•„ë«ì§‘ ëˆ„ìˆ˜ ì±…ì„: ì¼ìƒìƒí™œë°°ìƒì±…ì„ë³´í—˜ ì²˜ë¦¬ ê¿€íŒ", k: "ì¼ìƒìƒí™œë°°ìƒì±…ì„ë³´í—˜", p: 4 },
                { t: "ì „ì„¸ ë³´ì¦ê¸ˆ ë°˜í™˜ ë‚´ìš©ì¦ëª… ì‘ì„±ë²• (ì–‘ì‹ ì²¨ë¶€)", k: "ì „ì„¸ë³´ì¦ê¸ˆë°˜í™˜", p: 2 },
                { t: "ì „ì„¸ì‚¬ê¸° ì˜ˆë°©: ë“±ê¸°ë¶€ë“±ë³¸ ì„êµ¬ ê·¼ì €ë‹¹ ê³„ì‚°ë²•", k: "ì „ì„¸ì‚¬ê¸°ì˜ˆë°©", p: 1 },
                { t: "ì›”ì„¸ ì´ì‚¬ ë‚˜ê°ˆ ë•Œ ë„ë°° ì¥íŒ ì›ìƒë³µêµ¬ ê¸°ì¤€", k: "ì›ìƒë³µêµ¬ì˜ë¬´", p: 2 },
                { t: "ë¬µì‹œì  ê°±ì‹  í›„ í•´ì§€ í†µë³´: ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ëˆ„ê°€ ë‚¼ê¹Œ?", k: "ë¬µì‹œì ê°±ì‹ ", p: 3 },
                { t: "ì¥ê¸°ìˆ˜ì„ ì¶©ë‹¹ê¸ˆ ë°˜í™˜: ì´ì‚¬í•  ë•Œ ê¼­ ì±™ê²¨ì•¼ í•  ëˆ", k: "ì¥ê¸°ìˆ˜ì„ ì¶©ë‹¹ê¸ˆ", p: 1 },
                { t: "ì•„íŒŒíŠ¸ í™”ì¥ì‹¤ ë‹´ë°° ëƒ„ìƒˆ ì¸µê°„í¡ì—° ëŒ€ì²˜ë²•", k: "ì¸µê°„í¡ì—°", p: 1 },
                { t: "ë³´ì¼ëŸ¬ ê³ ì¥ ìˆ˜ë¦¬ë¹„ ì§‘ì£¼ì¸ vs ì„¸ì…ì ì±…ì„ ì†Œì¬", k: "ë³´ì¼ëŸ¬ìˆ˜ë¦¬", p: 2 },
                { t: "í–‰ë³µì£¼íƒ ì²­ë…„ ë²„íŒ€ëª© ì „ì„¸ìê¸ˆ ëŒ€ì¶œ ì¡°ê±´ ì •ë¦¬", k: "ë²„íŒ€ëª©ì „ì„¸", p: 4 }
            ],
            Crime: [
                { t: "ë³´ì´ìŠ¤í”¼ì‹± ì§€ê¸‰ì •ì§€ ê³¨ë“ íƒ€ì„ 30ë¶„ ëŒ€ì²˜ ë§¤ë‰´ì–¼", k: "ë³´ì´ìŠ¤í”¼ì‹±ì‹ ê³ ", p: 4 },
                { t: "ë‹¹ê·¼ë§ˆì¼“ ì‚¬ê¸° ì‹ ê³  ë°©ë²•: ë”ì¹˜íŠ¸ ì¡°íšŒë¶€í„° ê²½ì°°ì„œê¹Œì§€", k: "ì¤‘ê³ ê±°ë˜ì‚¬ê¸°", p: 1 },
                { t: "ìŠ¤ë¯¸ì‹± ë¬¸ì í´ë¦­í–ˆì„ ë•Œ í•´í‚¹ í™•ì¸ ë° ì´ˆê¸°í™” ë°©ë²•", k: "ìŠ¤ë¯¸ì‹±ë¬¸ì", p: 2 },
                { t: "í˜•ì‚¬ ë°°ìƒëª…ë ¹ì‹ ì²­ì„œ ì‘ì„±ë²•: ë¯¼ì‚¬ ì—†ì´ ëˆ ë°›ëŠ” ë²•", k: "ë°°ìƒëª…ë ¹ì‹ ì²­", p: 3 },
                { t: "í†µí™”ë…¹ìŒ ë²•ì  íš¨ë ¥: ìƒëŒ€ë°© ë™ì˜ ì—†ëŠ” ë…¹ì·¨ëŠ” ë¶ˆë²•?", k: "í†µí™”ë…¹ìŒí•©ë²•", p: 2 },
                { t: "ëª¸ìº í”¼ì‹± í˜‘ë°• ë¬´ëŒ€ì‘ì´ ë‹µ? ì˜ìƒ ìœ í¬ ë§‰ëŠ” ë²•", k: "ëª¸ìº í”¼ì‹±ëŒ€ì²˜", p: 4 },
                { t: "ë¡œë§¨ìŠ¤ ìŠ¤ìº  ì‚¬ê¸°: ì¸ìŠ¤íƒ€ ì™¸êµ­ì¸ ì˜ì‚¬ì˜ ì •ì²´", k: "ë¡œë§¨ìŠ¤ìŠ¤ìº ", p: 2 },
                { t: "ë¡¤ ëª¨ìš•ì£„ ê³ ì†Œ ì„±ë¦½ ìš”ê±´: íŠ¹ì •ì„± ê³µì—°ì„± ë¶„ì„", k: "ë¡¤ê³ ì†Œ", p: 1 },
                { t: "ìƒê°„ë…€ ì†Œì†¡ ì¦ê±° ìˆ˜ì§‘ê³¼ ìœ„ìë£Œ ì²­êµ¬ ê¸ˆì•¡", k: "ìƒê°„ë…€ì†Œì†¡", p: 4 },
                { t: "ëª…ì˜ˆí›¼ì†ì£„ ë²Œê¸ˆ ê¸°ì¤€: ì‚¬ì´ë²„ ëª¨ìš•ê³¼ ì‚¬ì‹¤ì ì‹œ", k: "ì‚¬ì´ë²„ëª…ì˜ˆí›¼ì†", p: 3 }
            ]
        };

        // Generator to create 160 items from templates (40 per leg)
        // We will cycle through the 10 templates per leg, adding variations to reach 40.
        const generateDb = () => {
            let data = [];
            let id = 1;

            legs.forEach(leg => {
                const templates = contentTemplates[leg.id];
                // We need 40 items per leg. Templates provide 10 base ideas.
                // We will create 4 variations for each template to reach 40.
                
                templates.forEach((tmpl, idx) => {
                    // Variation 1: Basic (Lv based on template)
                    data.push(createItem(id++, leg.id, tmpl.t, tmpl.k, tmpl.p, "ê¸°ë³¸ ê°œë… ì •ë¦¬"));
                    // Variation 2: Case Study (Phase + 0 or 1)
                    data.push(createItem(id++, leg.id, `[ì‚¬ë¡€] ${tmpl.k} ì‹¤ì œ í•´ê²° í›„ê¸° ë° íŒë¡€ ë¶„ì„`, tmpl.k + "í›„ê¸°", Math.min(4, tmpl.p + 1), "ì‹¤ì œ ì‚¬ë¡€ ì¤‘ì‹¬"));
                    // Variation 3: Q&A / FAQ (Phase 1 or 2 - Traffic)
                    data.push(createItem(id++, leg.id, `${tmpl.k} ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ BEST 5 ì´ì •ë¦¬`, tmpl.k + "ì§ˆë¬¸", Math.max(1, tmpl.p - 1), "Q&A í˜•ì‹"));
                    // Variation 4: Deep Dive / Update (Phase 3 or 4 - Trust/Money)
                    data.push(createItem(id++, leg.id, `2026ë…„ ${tmpl.k} ë²• ê°œì • ì‚¬í•­ ë° ì£¼ì˜í•  ì `, tmpl.k + "ë²•ê°œì •", 3, "ìµœì‹  ë²•ë ¹ ë¶„ì„"));
                });
            });
            
            // Sort by ID to keep legs grouped, or shuffle? Grouped is better for now.
            // But we want "Roadmap" to sort by Phase primarily.
            return data;
        };

        const createItem = (id, legId, title, keyword, phase, type) => {
            // Auto-generate hook/body based on context (simulated for prototype)
            let hook = "ì´ ê¸€ì„ ì½ì§€ ì•Šìœ¼ë©´ 100ë§Œ ì› ì†í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            let body = "ë…ìì˜ ê³µí¬ì‹¬ì„ ìê·¹í•˜ê³  í•´ê²°ì±…ì„ ì œì‹œí•˜ì„¸ìš”. ë²•ì  ê·¼ê±°(ì œOì¡°)ë¥¼ ëª…ì‹œí•˜ì—¬ ì‹ ë¢°ë¥¼ ë†’ì´ì„¸ìš”.";
            let seo = `${keyword}, ${keyword}ë¹„ìš©, ${keyword}ì ˆì°¨`;
            let cpa = legId === 'Debt' ? 'ê°œì¸íšŒìƒ ë¬´ë£Œ ì¡°íšŒ' : legId === 'Traffic' ? 'êµí†µì‚¬ê³  í•©ì˜ê¸ˆ ì‚°ì¶œ' : 'ë¬´ë£Œ ë²•ë¥  ìƒë‹´';

            return {
                id,
                leg: legId,
                title: `${title} /// ${keyword}`,
                keyword,
                phase, // 1, 2, 3, 4
                hook,
                body,
                seo,
                cpa,
                published: false,
                url: ''
            };
        };

        // Initialize Data
        let db = generateDb();
        const STORAGE_KEY = 'lawgear_pacemaker_v1';

        // --- 2. CORE LOGIC ---

        function init() {
            loadData();
            updateUI();
        }

        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const savedData = JSON.parse(saved);
                // Merge saved status into db
                savedData.forEach(s => {
                    const item = db.find(d => d.id === s.id);
                    if (item) {
                        item.published = s.published;
                        item.url = s.url;
                    }
                });
            }
        }

        function saveData() {
            const dataToSave = db.filter(d => d.published).map(d => ({
                id: d.id,
                published: d.published,
                url: d.url
            }));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            updateUI();
        }

        function getProgress() {
            const total = db.length;
            const done = db.filter(d => d.published).length;
            return { total, done, percent: Math.round((done / total) * 100) };
        }

        function getNextMission() {
            // Find the first unpublished item, prioritized by Phase (1 -> 4)
            return db.sort((a, b) => a.phase - b.phase).find(d => !d.published);
        }

        // --- 3. UI UPDATES ---

        function updateUI() {
            const p = getProgress();
            
            // Global Progress
            document.getElementById('globalProgressBar').style.width = `${p.percent}%`;
            document.getElementById('globalProgressText').innerText = `${p.percent}%`;
            document.getElementById('totalPublishedCount').innerText = p.done;
            document.getElementById('remainingCount').innerText = p.total - p.done;

            // Phase Title Logic
            const nextItem = getNextMission();
            if (nextItem) {
                const phaseNames = ["ê¸°ì´ˆ ê³µì‚¬ (Base)", "íŠ¸ë˜í”½ í­ë°œ (Expansion)", "ì‹ ë¢° êµ¬ì¶• (Authority)", "ìˆ˜ìµ ì‚¬ëƒ¥ (Monetization)"];
                const phaseDescs = [
                    "ë¸”ë¡œê·¸ ì§€ìˆ˜ë¥¼ ìŒ“ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì‰¬ìš´ í‚¤ì›Œë“œë¡œ 'ìœ íš¨íƒ€'ë¥¼ ë§Œë“œì„¸ìš”.",
                    "ì´ìŠˆì„± í‚¤ì›Œë“œë¡œ ë°©ë¬¸ìë¥¼ ëŒì–´ëª¨ìœ¼ì„¸ìš”. ìœ ì…ì´ ê¹¡íŒ¨ì…ë‹ˆë‹¤.",
                    "ì „ë¬¸ê°€ í¬ì§€ì…”ë‹ìœ¼ë¡œ ì²´ë¥˜ì‹œê°„ì„ ëŠ˜ë¦¬ì„¸ìš”. ì´ì›ƒì„ íŒ¬ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.",
                    "ê³ ë‹¨ê°€ CPAë¡œ ìˆ˜ìµì„ ê·¹ëŒ€í™”í•˜ì„¸ìš”. ì´ì œ ëˆì„ ë²Œ ì‹œê°„ì…ë‹ˆë‹¤."
                ];
                document.getElementById('currentPhaseTitle').innerHTML = `Lv.${nextItem.phase} ${phaseNames[nextItem.phase-1]}`;
                document.getElementById('currentPhaseDesc').innerText = phaseDescs[nextItem.phase-1];

                // Next Mission Card
                document.getElementById('nextMissionTitle').innerText = nextItem.title.split('///')[0];
                document.getElementById('nextMissionHook').innerText = `"${nextItem.hook}"`;
                document.getElementById('nextMissionLeg').innerText = nextItem.leg.toUpperCase();
            } else {
                // All done
                document.getElementById('currentPhaseTitle').innerText = "ğŸ‰ ë§ˆìŠ¤í„°(Master)";
                document.getElementById('currentPhaseDesc').innerText = "ëª¨ë“  í€˜ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ì´ì œ ìˆ˜ìµì„ ì¦ê¸°ì„¸ìš”.";
                document.getElementById('nextMissionTitle').innerText = "ì™„ë£Œ!";
            }

            renderRoadmap();
            renderFullLibrary();
        }

        function renderRoadmap() {
            // Render 4 phases
            for(let i=1; i<=4; i++) {
                const container = document.getElementById(`phase${i}-grid`);
                container.innerHTML = '';
                
                // Filter items for this phase
                const items = db.filter(d => d.phase === i);
                
                items.forEach(item => {
                    const isDone = item.published;
                    const legColor = item.leg === 'Traffic' ? 'amber' : item.leg === 'Debt' ? 'indigo' : item.leg === 'Housing' ? 'emerald' : 'rose';
                    
                    const el = document.createElement('div');
                    el.className = `bg-white p-4 rounded-xl border ${isDone ? 'border-slate-200 opacity-60' : 'border-slate-200'} card-shadow card-hover relative group cursor-pointer`;
                    if(!isDone) el.classList.add('border-l-4', `border-l-${legColor}-500`);
                    
                    el.onclick = () => openModal(item.id);

                    el.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-${legColor}-50 text-${legColor}-700 uppercase">${item.leg}</span>
                            ${isDone ? '<i class="fa-solid fa-circle-check text-emerald-500"></i>' : '<i class="fa-regular fa-circle text-slate-300 group-hover:text-indigo-400"></i>'}
                        </div>
                        <h4 class="text-sm font-bold text-slate-800 leading-snug ${isDone ? 'line-through text-slate-400' : ''}">${item.title.split('///')[0]}</h4>
                        <div class="mt-3 flex items-center justify-between">
                            <span class="text-xs text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded">ğŸ”‘ ${item.keyword}</span>
                        </div>
                    `;
                    container.appendChild(el);
                });
            }
        }

        function renderFullLibrary() {
            const container = document.getElementById('fullLibraryGrid');
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filter = document.querySelector('.filter-btn.active').dataset.filter || 'all'; // all, published, unpublished
            
            container.innerHTML = '';

            const filtered = db.filter(d => {
                const matchSearch = d.title.toLowerCase().includes(search) || d.keyword.toLowerCase().includes(search);
                const matchFilter = filter === 'all' ? true : filter === 'published' ? d.published : !d.published;
                return matchSearch && matchFilter;
            });

            filtered.forEach(item => {
                const el = document.createElement('div');
                el.className = "bg-white p-3 rounded-lg border border-slate-200 shadow-sm text-sm hover:border-indigo-300 cursor-pointer flex flex-col justify-between h-32";
                el.onclick = () => openModal(item.id);
                el.innerHTML = `
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="w-2 h-2 rounded-full ${item.published ? 'bg-emerald-500' : 'bg-slate-300'}"></span>
                            <span class="text-xs text-slate-400 font-bold uppercase">${item.leg}</span>
                        </div>
                        <p class="font-medium text-slate-800 line-clamp-2">${item.title.split('///')[0]}</p>
                    </div>
                    <div class="text-xs text-slate-500 bg-slate-50 px-2 py-1 rounded w-fit mt-2">Lv.${item.phase}</div>
                `;
                container.appendChild(el);
            });
        }

        // --- 4. MODAL LOGIC ---
        let currentModalId = null;

        function openModal(id) {
            currentModalId = id;
            const item = db.find(d => d.id === id);
            
            // Fill Data
            const legColor = item.leg === 'Traffic' ? 'bg-amber-500' : item.leg === 'Debt' ? 'bg-indigo-500' : item.leg === 'Housing' ? 'bg-emerald-500' : 'bg-rose-500';
            document.getElementById('m-leg').className = `px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider text-white ${legColor}`;
            document.getElementById('m-leg').innerText = item.leg;
            document.getElementById('m-phase').innerText = `LV.${item.phase}`;
            
            document.getElementById('m-title').innerText = item.title.split('///')[0];
            document.getElementById('m-copy-text').innerText = item.title;
            document.getElementById('m-keyword').innerText = item.keyword;
            document.getElementById('m-hook').innerText = `"${item.hook}"`;
            document.getElementById('m-body').innerText = item.body;
            
            // SEO Tags
            document.getElementById('m-seo').innerHTML = item.seo.split(',').map(s => `<span class="bg-slate-100 text-slate-600 px-2 py-1 rounded text-xs">#${s.trim()}</span>`).join('');

            // Status Checkbox
            const checkbox = document.getElementById('m-published-check');
            checkbox.checked = item.published;
            togglePublishStatus(false); // Update UI without saving yet
            
            document.getElementById('m-url-input').value = item.url || '';

            // Show
            const modal = document.getElementById('modal');
            modal.classList.remove('hidden');
            setTimeout(() => document.getElementById('modalContent').classList.remove('scale-95'), 10);
        }

        function closeModal() {
            document.getElementById('modalContent').classList.add('scale-95');
            setTimeout(() => document.getElementById('modal').classList.add('hidden'), 200);
        }

        function togglePublishStatus(save = true) {
            const checkbox = document.getElementById('m-published-check');
            const urlSection = document.getElementById('m-url-section');
            
            if (checkbox.checked) {
                urlSection.classList.remove('hidden');
                if(save) updateItemStatus(true);
            } else {
                urlSection.classList.add('hidden');
                if(save) updateItemStatus(false);
            }
        }

        function saveUrl() {
            const url = document.getElementById('m-url-input').value;
            const item = db.find(d => d.id === currentModalId);
            if(item) {
                item.url = url;
                saveData();
            }
        }

        function updateItemStatus(published) {
            const item = db.find(d => d.id === currentModalId);
            if(item) {
                item.published = published;
                saveData(); // Auto save
            }
        }

        function openNextMission() {
            const next = getNextMission();
            if(next) openModal(next.id);
        }

        function sendToTelegram(event) {
            event.stopPropagation();
            const nextItem = getNextMission();
            if(!nextItem) {
                alert("ëª¨ë“  ë¯¸ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!");
                return;
            }

            const message = `[Law Gear í˜ì´ìŠ¤ë©”ì´ì»¤]\nğŸ”¥ ì˜¤ëŠ˜ì˜ ê¸€ê° ë„ì°©!\n\nLv.${nextItem.phase} ë¯¸ì…˜\nğŸ· ì£¼ì œ: ${nextItem.title.split('///')[0]}\nğŸ”‘ í‚¤ì›Œë“œ: ${nextItem.keyword}\nğŸª í›…: "${nextItem.hook}"\n\nâœï¸ ê³µëµ í¬ì¸íŠ¸:\n${nextItem.body}\n\n(ì‘ì„± í›„ ëŒ€ì‹œë³´ë“œì—ì„œ ì²´í¬í•˜ì„¸ìš”!)`;
            
            const encodedMsg = encodeURIComponent(message);
            // Open Telegram Share Link (works on mobile/desktop)
            window.open(`https://t.me/share/url?url=${window.location.href}&text=${encodedMsg}`, '_blank');
        }

        // --- 5. UTILS ---
        function switchView(view) {
            ['roadmap', 'library', 'settings'].forEach(v => {
                document.getElementById(`${v}-view`).classList.add('hidden');
            });
            document.getElementById(`${view}-view`).classList.remove('hidden');
            
            // Filter tabs logic
            if(view === 'library') {
                // ...
            }
        }

        function copyToClipboard(id) {
            const text = document.getElementById(id).innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: ' + text);
            });
        }

        function exportData() {
            const dataToSave = db.filter(d => d.published).map(d => ({ id: d.id, published: d.published, url: d.url }));
            const blob = new Blob([JSON.stringify(dataToSave)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lawgear_backup_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
        }

        function importData(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = e => {
                const loaded = JSON.parse(e.target.result);
                loaded.forEach(s => {
                    const item = db.find(d => d.id === s.id);
                    if(item) { item.published = s.published; item.url = s.url; }
                });
                saveData();
                alert('ë³µì› ì™„ë£Œ!');
            };
            reader.readAsText(file);
        }

        function resetData() {
            if(confirm('ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // Library Filter
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.classList.remove('bg-slate-800', 'text-white');
                    b.classList.add('bg-white', 'text-slate-600');
                    b.classList.remove('active');
                });
                e.target.classList.remove('bg-white', 'text-slate-600');
                e.target.classList.add('bg-slate-800', 'text-white', 'active');
                renderFullLibrary();
            });
        });

        document.getElementById('searchInput').addEventListener('input', renderFullLibrary);

        // Init
        init();

    </script>
</body>
</html>
