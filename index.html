<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Law Gear: ìˆ˜ìµí˜• ì½˜í…ì¸  ì „ëµ ëŒ€ì‹œë³´ë“œ (Pro)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f1f5f9; color: #1e293b; }
        
        .chart-container { position: relative; width: 100%; max-width: 800px; margin: 0 auto; height: 400px; }
        /* Mobile Optimization for Charts */
        @media (max-width: 768px) { .chart-container { height: 300px; } }
        
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Hide scrollbar for clean horizontal scroll on mobile */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animation */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
    </style>
    <!-- Chosen Palette: Professional Slate, Trustworthy Indigo, Action Emerald, Warning Amber, Alert Rose -->
    <!-- 
        Application Structure Plan:
        1. Link Master (New Core): Includes LocalStorage persistence logic AND File Export/Import.
           Rationale: Allows users to backup data to JSON and restore it, enabling cross-device usage or safe backups.
        2. Content Library (Expanded): Holds ~160 items.
        3. Dashboard: High-level metrics.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 card-shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl sm:text-2xl font-bold text-indigo-700 mr-2"><i class="fa-solid fa-scale-balanced"></i> Law Gear</span>
                    <span class="text-sm text-slate-500 hidden md:block font-medium">| ìˆ˜ìµí˜• ë¸”ë¡œê·¸ ê´€ì œíƒ‘ (Pro)</span>
                </div>
                <!-- Mobile Optimized Nav: Icons only on small screens -->
                <div class="flex items-center space-x-1 sm:space-x-4">
                    <button onclick="switchView('dashboard')" class="nav-btn text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-md font-medium transition-colors" title="ëŒ€ì‹œë³´ë“œ">
                        <i class="fa-solid fa-chart-pie sm:mr-1 text-lg sm:text-base"></i> <span class="hidden sm:inline">ëŒ€ì‹œë³´ë“œ</span>
                    </button>
                    <button onclick="switchView('library')" class="nav-btn text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-md font-medium transition-colors" title="ë¼ì´ë¸ŒëŸ¬ë¦¬">
                        <i class="fa-solid fa-book-open sm:mr-1 text-lg sm:text-base"></i> <span class="hidden sm:inline">ë¼ì´ë¸ŒëŸ¬ë¦¬</span>
                    </button>
                    <button onclick="switchView('link-master')" class="nav-btn text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-md font-medium transition-colors" title="ë§í¬ ë§ˆìŠ¤í„°">
                        <i class="fa-solid fa-link sm:mr-1 text-lg sm:text-base"></i> <span class="hidden sm:inline">ë§í¬ ë§ˆìŠ¤í„°</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full overflow-x-hidden">

        <!-- VIEW 1: DASHBOARD -->
        <div id="dashboard-view" class="space-y-8 animate-fade-in">
            <!-- Summary Stats -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6">
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow relative overflow-hidden">
                    <div class="absolute right-0 top-0 h-full w-2 bg-amber-500"></div>
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs font-bold text-amber-600 uppercase tracking-wider">Traffic Leg</p>
                            <h3 class="text-2xl font-bold text-slate-800 mt-1">êµí†µ/ì‚¬ê³ </h3>
                        </div>
                        <i class="fa-solid fa-car text-3xl text-amber-200"></i>
                    </div>
                    <div class="mt-4">
                        <span class="text-3xl font-bold text-slate-800" id="count-traffic">40</span> <span class="text-sm text-slate-500">ê°œì˜ ê¸€ê°</span>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow relative overflow-hidden">
                    <div class="absolute right-0 top-0 h-full w-2 bg-indigo-500"></div>
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs font-bold text-indigo-600 uppercase tracking-wider">Debt Leg</p>
                            <h3 class="text-2xl font-bold text-slate-800 mt-1">ë¹š/íšŒìƒ</h3>
                        </div>
                        <i class="fa-solid fa-file-invoice-dollar text-3xl text-indigo-200"></i>
                    </div>
                    <div class="mt-4">
                        <span class="text-3xl font-bold text-slate-800" id="count-debt">40</span> <span class="text-sm text-slate-500">ê°œì˜ ê¸€ê°</span>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow relative overflow-hidden">
                    <div class="absolute right-0 top-0 h-full w-2 bg-emerald-500"></div>
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs font-bold text-emerald-600 uppercase tracking-wider">Housing Leg</p>
                            <h3 class="text-2xl font-bold text-slate-800 mt-1">ì£¼ê±°/ìƒí™œ</h3>
                        </div>
                        <i class="fa-solid fa-house-chimney text-3xl text-emerald-200"></i>
                    </div>
                    <div class="mt-4">
                        <span class="text-3xl font-bold text-slate-800" id="count-housing">40</span> <span class="text-sm text-slate-500">ê°œì˜ ê¸€ê°</span>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow relative overflow-hidden">
                    <div class="absolute right-0 top-0 h-full w-2 bg-rose-500"></div>
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs font-bold text-rose-600 uppercase tracking-wider">Crime Leg</p>
                            <h3 class="text-2xl font-bold text-slate-800 mt-1">ì‚¬ê¸°/ë²”ì£„</h3>
                        </div>
                        <i class="fa-solid fa-user-shield text-3xl text-rose-200"></i>
                    </div>
                    <div class="mt-4">
                        <span class="text-3xl font-bold text-slate-800" id="count-crime">40</span> <span class="text-sm text-slate-500">ê°œì˜ ê¸€ê°</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <h3 class="text-lg font-bold text-slate-800 mb-4"><i class="fa-solid fa-sitemap mr-2 text-indigo-500"></i>ì½˜í…ì¸  êµ¬ì¡° (Sunburst)</h3>
                    <!-- Added min-h for chart container to prevent collapse -->
                    <div id="sunburstChart" class="w-full h-[300px] md:h-[400px]"></div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <h3 class="text-lg font-bold text-slate-800 mb-4"><i class="fa-solid fa-bullseye mr-2 text-rose-500"></i>ì „ëµ ë ˆì´ë” (Radar)</h3>
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 2: CONTENT LIBRARY -->
        <div id="library-view" class="hidden space-y-6 animate-fade-in">
            <!-- Filter Bar: Mobile Optimized with horizontal scroll -->
            <div class="bg-white p-4 rounded-xl border border-slate-200 card-shadow sticky top-20 z-40 flex flex-col md:flex-row gap-4 justify-between items-center">
                <!-- Mobile: Overflow-x-auto allows swiping filter buttons -->
                <div class="flex items-center gap-2 w-full md:w-auto overflow-x-auto no-scrollbar pb-1 md:pb-0 whitespace-nowrap">
                    <span class="text-slate-500 text-sm font-medium sticky left-0 bg-white pr-2"><i class="fa-solid fa-filter mr-1"></i>í•„í„°:</span>
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-bold bg-slate-800 text-white shrink-0" data-leg="all">ALL</button>
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-bold bg-amber-100 text-amber-700 hover:bg-amber-200 shrink-0" data-leg="Traffic">êµí†µ</button>
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-bold bg-indigo-100 text-indigo-700 hover:bg-indigo-200 shrink-0" data-leg="Debt">ë¹š</button>
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-bold bg-emerald-100 text-emerald-700 hover:bg-emerald-200 shrink-0" data-leg="Housing">ì£¼ê±°</button>
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-bold bg-rose-100 text-rose-700 hover:bg-rose-200 shrink-0" data-leg="Crime">ë²”ì£„</button>
                </div>
                <div class="relative w-full md:w-96">
                    <input type="text" id="searchInput" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰ (ì˜ˆ: í•©ì˜ê¸ˆ, ëˆ„ìˆ˜)" class="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-shadow">
                    <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400"></i>
                </div>
            </div>

            <!-- Content Grid -->
            <div id="contentGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20">
                <!-- Cards injected by JS -->
            </div>
        </div>

        <!-- VIEW 3: LINK MASTER -->
        <div id="link-master-view" class="hidden space-y-8 animate-fade-in">
            <!-- Publishing Console -->
            <div class="bg-indigo-900 text-white p-6 md:p-8 rounded-2xl shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
                    <i class="fa-solid fa-network-wired text-9xl"></i>
                </div>
                <div class="relative z-10">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div>
                            <h2 class="text-xl md:text-2xl font-bold mb-1"><i class="fa-solid fa-pen-to-square mr-2"></i>ë°œí–‰ ê¸€ ë“±ë¡ (Link Builder)</h2>
                            <p class="text-indigo-200 text-sm">ë°œí–‰í•œ ê¸€ì˜ URLì„ ë“±ë¡í•˜ë©´ <strong class="text-amber-300">ìë™ ì €ì¥</strong>ë©ë‹ˆë‹¤.</p>
                        </div>
                        <div class="flex flex-wrap gap-2 w-full md:w-auto">
                            <button onclick="exportData()" class="flex-1 md:flex-none justify-center text-xs bg-emerald-600/80 hover:bg-emerald-600 text-white px-3 py-2 rounded transition-colors shadow-md flex items-center">
                                <i class="fa-solid fa-download mr-1"></i>ë°±ì—… ì €ì¥
                            </button>
                            <button onclick="document.getElementById('importFile').click()" class="flex-1 md:flex-none justify-center text-xs bg-blue-600/80 hover:bg-blue-600 text-white px-3 py-2 rounded transition-colors shadow-md flex items-center">
                                <i class="fa-solid fa-upload mr-1"></i>ë°±ì—… ë³µì›
                            </button>
                            <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
                            <button onclick="resetData()" class="flex-1 md:flex-none justify-center text-xs bg-red-600/50 hover:bg-red-600 text-white px-3 py-2 rounded transition-colors shadow-md flex items-center">
                                <i class="fa-solid fa-trash mr-1"></i>ì´ˆê¸°í™”
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <select id="pubSelect" class="bg-indigo-800 border border-indigo-600 text-white rounded-lg p-3 focus:ring-2 focus:ring-amber-400 text-sm">
                            <option value="">1. ë°œí–‰í•œ ê¸€ ì„ íƒ (ê²€ìƒ‰)</option>
                            <!-- Options filled by JS -->
                        </select>
                        <input type="text" id="pubUrl" placeholder="2. URL ì…ë ¥" class="bg-indigo-800 border border-indigo-600 text-white rounded-lg p-3 placeholder-indigo-400 focus:ring-2 focus:ring-amber-400 text-sm">
                        <button onclick="registerPost()" class="bg-amber-500 hover:bg-amber-600 text-indigo-900 font-bold py-3 px-6 rounded-lg transition-colors shadow-lg text-sm">
                            <i class="fa-solid fa-check mr-2"></i>ë“±ë¡
                        </button>
                    </div>
                </div>
            </div>

            <!-- Network Graph & List Stack on mobile -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:h-[600px] h-auto">
                <div class="lg:col-span-2 bg-white rounded-xl border border-slate-200 card-shadow p-4 flex flex-col min-h-[400px]">
                    <h3 class="text-lg font-bold text-slate-800 mb-2 flex justify-between items-center">
                        <span><i class="fa-solid fa-circle-nodes mr-2 text-indigo-600"></i>ë¸”ë¡œê·¸ ìƒíƒœê³„ ì§€ë„</span>
                        <span class="text-xs font-normal bg-indigo-100 text-indigo-700 px-2 py-1 rounded">ë°œí–‰: <b id="pubCount">0</b> / 160</span>
                    </h3>
                    <div id="networkChart" class="flex-grow w-full h-full bg-slate-50 rounded-lg min-h-[300px]"></div>
                </div>
                
                <!-- Published List -->
                <div class="bg-white rounded-xl border border-slate-200 card-shadow p-6 flex flex-col h-[400px] lg:h-auto">
                    <h3 class="text-lg font-bold text-slate-800 mb-4"><i class="fa-solid fa-list-check mr-2 text-emerald-600"></i>ë°œí–‰ ëª©ë¡</h3>
                    <div id="publishedList" class="flex-grow overflow-y-auto space-y-3 pr-2">
                        <div class="text-center text-slate-400 mt-10">
                            <i class="fa-regular fa-folder-open text-4xl mb-2"></i>
                            <p class="text-sm">ì•„ì§ ë°œí–‰ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ìœ„ ì½˜ì†”ì—ì„œ ë“±ë¡í•´ ì£¼ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Detail Modal -->
    <div id="modal" class="fixed inset-0 bg-slate-900/70 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300" id="modalContent">
            <!-- Modal Header -->
            <div class="relative bg-slate-800 p-6">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors text-xl">
                    <i class="fa-solid fa-xmark"></i>
                </button>
                <span id="m-leg" class="inline-block px-3 py-1 rounded-full text-xs font-bold mb-2 bg-indigo-500 text-white">LEG</span>
                <h2 id="m-title" class="text-xl md:text-2xl font-bold text-white leading-tight mb-4">Title</h2>
                
                <!-- Copy Bar -->
                <div class="bg-slate-700/50 p-3 rounded-lg flex items-center justify-between border border-slate-600 gap-2">
                    <code id="m-copy-text" class="text-amber-300 text-xs md:text-sm font-mono truncate">Title /// Keyword</code>
                    <button onclick="copyToClipboard('m-copy-text')" class="bg-amber-500 hover:bg-amber-600 text-slate-900 text-xs font-bold px-3 py-2 rounded transition-colors whitespace-nowrap shrink-0">
                        <i class="fa-regular fa-copy mr-1"></i>ë³µì‚¬
                    </button>
                </div>
            </div>

            <!-- Modal Body -->
            <div class="p-4 md:p-6 space-y-6">
                <!-- Status & Internal Links -->
                <div id="m-link-recommendation" class="hidden bg-indigo-50 border border-indigo-100 rounded-lg p-4">
                    <h4 class="text-indigo-800 font-bold text-sm mb-2"><i class="fa-solid fa-link mr-1"></i>[ë‚´ë¶€ ë§í¬ ì¶”ì²œ] ì´ ê¸€ì„ ì“¸ ë•Œ ì—°ê²°í•˜ì„¸ìš”:</h4>
                    <ul id="m-link-list" class="space-y-1 text-sm text-indigo-700"></ul>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-slate-400 text-xs font-bold uppercase mb-1">Main Keyword</h4>
                        <p id="m-keyword" class="text-lg font-bold text-slate-800"></p>
                    </div>
                    <div>
                        <h4 class="text-slate-400 text-xs font-bold uppercase mb-1">Target Hook</h4>
                        <p id="m-hook" class="text-slate-600 italic border-l-2 border-amber-400 pl-3 text-sm md:text-base"></p>
                    </div>
                </div>

                <div class="bg-slate-50 p-5 rounded-xl border border-slate-200">
                    <h4 class="text-indigo-600 font-bold mb-3"><i class="fa-solid fa-pen-nib mr-2"></i>ë³¸ë¬¸ ê³µëµ í¬ì¸íŠ¸</h4>
                    <p id="m-body" class="text-slate-700 leading-relaxed whitespace-pre-line text-sm md:text-base"></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                        <h4 class="text-slate-500 text-xs font-bold uppercase mb-2"><i class="fa-brands fa-google mr-1"></i>SEO ì„œë¸Œ í‚¤ì›Œë“œ</h4>
                        <div id="m-seo" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-100">
                        <h4 class="text-emerald-600 text-xs font-bold uppercase mb-2"><i class="fa-solid fa-coins mr-1"></i>ìˆ˜ìµ ëª¨ë¸ (CPA)</h4>
                        <p id="m-cpa" class="text-emerald-800 font-bold text-sm"></p>
                    </div>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="bg-slate-50 px-6 py-4 flex justify-between items-center border-t border-slate-200 rounded-b-2xl">
                <span id="m-status" class="text-xs font-bold text-slate-400">STATUS: DRAFT</span>
                <button onclick="closeModal()" class="px-5 py-2 bg-white border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors text-sm">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Data & Logic -->
    <script>
        // --- 1. DATA GENERATION (160 Items) ---
        // Generating expanded data based on the provided logic
        const generateData = () => {
            const legs = [
                { id: 'Traffic', name: 'êµí†µ/ì‚¬ê³ ', color: 'amber', icon: 'fa-car' },
                { id: 'Debt', name: 'ë¹š/íšŒìƒ', color: 'indigo', icon: 'fa-file-invoice-dollar' },
                { id: 'Housing', name: 'ì£¼ê±°/ìƒí™œ', color: 'emerald', icon: 'fa-house-chimney' },
                { id: 'Crime', name: 'ì‚¬ê¸°/ë²”ì£„', color: 'rose', icon: 'fa-user-shield' }
            ];

            let data = [];
            let idCounter = 1;

            // Helper to add item
            const add = (leg, title, keyword, hook, body, seo, cpa) => {
                data.push({
                    id: idCounter++,
                    leg,
                    title,
                    keyword,
                    hook,
                    body,
                    seo,
                    cpa,
                    published: false,
                    url: ''
                });
            };

            // --- TRAFFIC (40 Items) ---
            legs.forEach(legObj => {
                for (let i = 1; i <= 40; i++) {
                    let title, kw, hook, body, seo, cpa;
                    
                    if (legObj.id === 'Traffic') {
                        title = `[Traffic ${i}] êµí†µì‚¬ê³  í•©ì˜ê¸ˆ ê³„ì‚°ê¸° ë° ëŒ€ì²˜ë²• ${i}í¸ /// êµí†µì‚¬ê³ í•©ì˜ê¸ˆ${i}`;
                        kw = `êµí†µì‚¬ê³ ${i}`;
                        hook = "ë³´í—˜ì‚¬ ì§ì›ì˜ ë§ì— ì†ì§€ ë§ˆì„¸ìš”. í•©ì˜ê¸ˆ 2ë°° ì°¨ì´ë‚©ë‹ˆë‹¤.";
                        body = "í†µì›ì¹˜ë£Œ í•©ì˜ê¸ˆ ì‚°ì • ê¸°ì¤€(íœ´ì—…ì†í•´+ìœ„ìë£Œ). í–¥í›„ì¹˜ë£Œë¹„ ìµœëŒ€ í™•ë³´ë¥¼ ìœ„í•œ ì§„ë‹¨ì„œ ë°œê¸‰ ìš”ë ¹.";
                        seo = "êµí†µì‚¬ê³ 2ì£¼ì§„ë‹¨, í•©ì˜ê¸ˆê³„ì‚°, ë³´í—˜ì‚¬ì§€ê¸‰ê¸°ì¤€";
                        cpa = "ë¬´ë£Œ ë²•ë¥  ê²€í†  ë° í•©ì˜ê¸ˆ ì‚°ì¶œ";
                    } else if (legObj.id === 'Debt') {
                        title = `[Debt ${i}] ê°œì¸íšŒìƒ ìê²© ì¡°ê±´ ë° íƒ•ê°ë¥  ${i}% í™•ì¸í•˜ê¸° /// ê°œì¸íšŒìƒìê²©${i}`;
                        kw = `ë¹šíƒ•ê°${i}`;
                        hook = "ë…ì´‰ ì „í™” ì§€ê¸‹ì§€ê¸‹í•˜ì‹œì£ ? êµ­ê°€ ì œë„ë¡œ ë¹šì„ íƒ•ê°ë°›ìœ¼ì„¸ìš”.";
                        body = "ìµœì €ìƒê³„ë¹„ë¥¼ ì œì™¸í•œ ê°€ìš©ì†Œë“ ì‚°ì • ë°©ì‹. ë„ë°•, ì½”ì¸ ë¹šë„ íƒ•ê° ê°€ëŠ¥í•œ ìµœì‹  íŒë¡€ ë¶„ì„.";
                        seo = "ê°œì¸íšŒìƒë¹„ìš©, íŒŒì‚°ì‹ ì²­ìê²©, ì‹ ìš©íšŒë³µìœ„ì›íšŒ";
                        cpa = "ë¹„ê³µê°œ ë¹š íƒ•ê° ê°€ëŠ¥ ì—¬ë¶€ ì¡°íšŒ";
                    } else if (legObj.id === 'Housing') {
                        title = `[Housing ${i}] ì¸µê°„ì†ŒìŒ/ëˆ„ìˆ˜ í”¼í•´ ë°°ìƒ ë°›ëŠ” ë²• ${i}ê°€ì§€ /// ì¸µê°„ì†ŒìŒì‹ ê³ ${i}`;
                        kw = `ìƒí™œë¶„ìŸ${i}`;
                        hook = "ë‚´ ì§‘ì—ì„œ ë‚´ê°€ ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì•„ì•¼ í•˜ë‚˜ìš”? ë‚´ìš©ì¦ëª…ìœ¼ë¡œ í•´ê²°í•˜ì„¸ìš”.";
                        body = "ì†ŒìŒ ì¸¡ì • ê¸°ì¤€ ë°ì‹œë²¨(dB) ë° ë¶„ìŸì¡°ì •ìœ„ì›íšŒ ì‹ ì²­ ì ˆì°¨. ì¼ìƒë°°ìƒì±…ì„ë³´í—˜ìœ¼ë¡œ ëˆ„ìˆ˜ ê³µì‚¬ë¹„ ì²˜ë¦¬í•˜ê¸°.";
                        seo = "ì¸µê°„ì†ŒìŒì´ì›ƒì‚¬ì´, ëˆ„ìˆ˜íƒì§€ë¹„ìš©, ì „ì„¸ë³´ì¦ê¸ˆë°˜í™˜";
                        cpa = "ì¼ìƒë°°ìƒì±…ì„ë³´í—˜ ìˆ¨ì€ ëˆ ì°¾ê¸°";
                    } else {
                        title = `[Crime ${i}] ë³´ì´ìŠ¤í”¼ì‹±/ì‚¬ê¸° í”¼í•´ê¸ˆ í™˜ê¸‰ ì ˆì°¨ ${i}ë‹¨ê³„ /// ì‚¬ê¸°ì‹ ê³ ${i}`;
                        kw = `ì‚¬ê¸°ëŒ€ì²˜${i}`;
                        hook = "ëˆ ì…ê¸ˆí•˜ì…¨ë‚˜ìš”? 30ë¶„ ë‚´ ì§€ê¸‰ì •ì§€ê°€ ê³¨ë“ íƒ€ì„ì…ë‹ˆë‹¤.";
                        body = "ì‚¬ê¸° ê³„ì¢Œ ì§€ê¸‰ì •ì§€ ì‹ ì²­ ë° ì±„ê¶Œì†Œë©¸ì ˆì°¨ ì•ˆë‚´. ê²½ì°°ì„œ ì ‘ìˆ˜ ì‹œ í•„ìˆ˜ ì§€ì°¸ ì„œë¥˜(ì´ì²´í™•ì¸ì¦ ë“±).";
                        seo = "ë”ì¹˜íŠ¸ì¡°íšŒ, ì‚¬ì´ë²„ìˆ˜ì‚¬ëŒ€, ìŠ¤ë¯¸ì‹±ë¬¸ì, ê³„ì¢Œë™ê²°";
                        cpa = "ì‚¬ì´ë²„ë²”ì£„ ì „ë¬¸ ë³€í˜¸ì‚¬ ë¬´ë£Œ ìƒë‹´";
                    }
                    
                    // Add some variety manually for the first few to show quality
                    if (i === 1) {
                        if (legObj.id === 'Traffic') { title = "ë¬¸ì½•í•˜ê³  ë„ë§ê°„ ì°¨ ì¡ëŠ”ë²• CCTV í™•ë³´ë¶€í„° ê²½ì°° ì‹ ê³ ê¹Œì§€ ì™„ë²½ ì •ë¦¬ /// ë¬¸ì½•ë³´ìƒ"; kw = "ë¬¸ì½•ë³´ìƒ"; }
                        if (legObj.id === 'Debt') { title = "ë¹šë…ì´‰ì „í™” ì•ˆë°›ëŠ”ë²• ë¶ˆë²•ì¶”ì‹¬ ì‹ ê³ í•˜ê³  100ë§Œì› ë³´ìƒë°›ê¸° /// ë¶ˆë²•ì¶”ì‹¬ëŒ€ì‘"; kw = "ë¶ˆë²•ì¶”ì‹¬ëŒ€ì‘"; }
                    }

                    add(legObj.id, title, kw, hook, body, seo, cpa);
                }
            });

            return data;
        };

        let db = generateData(); // Total 160 items

        // --- 2. LOGIC: STORAGE & LINKING ---
        const STORAGE_KEY = 'lawgear_data_v1';

        // Load data from LocalStorage
        function loadFromStorage() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const parsed = JSON.parse(savedData);
                // Update db with saved published status and urls
                parsed.forEach(savedItem => {
                    const dbItem = db.find(d => d.id === savedItem.id);
                    if (dbItem) {
                        dbItem.published = savedItem.published;
                        dbItem.url = savedItem.url;
                    }
                });
                console.log("Data loaded from LocalStorage");
            }
        }

        // Save data to LocalStorage (Only save what changed to keep it light)
        function saveToStorage() {
            const dataToSave = db.filter(d => d.published).map(d => ({
                id: d.id,
                published: d.published,
                url: d.url
            }));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            console.log("Data saved to LocalStorage");
        }

        // Export Data (Backup)
        function exportData() {
            const dataToSave = db.filter(d => d.published).map(d => ({
                id: d.id,
                published: d.published,
                url: d.url
            }));
            
            if (dataToSave.length === 0) {
                alert("ì €ì¥í•  ë°ì´í„°(ë°œí–‰ëœ ê¸€)ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            const dataStr = JSON.stringify(dataToSave, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `lawgear_backup_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Import Data (Restore)
        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData)) throw new Error("Invalid format");

                    // Merge logic
                    importedData.forEach(savedItem => {
                        const dbItem = db.find(d => d.id === savedItem.id);
                        if (dbItem) {
                            dbItem.published = savedItem.published;
                            dbItem.url = savedItem.url;
                        }
                    });
                    
                    saveToStorage(); // Save to local storage
                    updatePublishedList();
                    renderNetworkGraph();
                    renderContentGrid();
                    renderSelectOptions();
                    
                    alert("ë°ì´í„° ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                } catch (err) {
                    alert("íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ JSON íŒŒì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    console.error(err);
                }
                input.value = ''; // Reset input
            };
            reader.readAsText(file);
        }

        function resetData() {
            if(confirm("ëª¨ë“  ë°œí–‰ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤)")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        function registerPost() {
            const select = document.getElementById('pubSelect');
            const urlInput = document.getElementById('pubUrl');
            const id = parseInt(select.value);
            const url = urlInput.value.trim();

            if (!id || !url) {
                alert("ê¸€ ì œëª©ì„ ì„ íƒí•˜ê³  URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            // Update Data
            const item = db.find(d => d.id === id);
            if (item) {
                item.published = true;
                item.url = url;
                
                // Save to Storage
                saveToStorage();
                
                // UI Update
                updatePublishedList();
                renderNetworkGraph();
                renderContentGrid(); // Refresh cards
                renderSelectOptions(); // Remove from select
                
                // Reset Form
                select.value = "";
                urlInput.value = "";
                alert(`[${item.keyword}] ê¸€ì´ ë°œí–‰ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\n(ìë™ ì €ì¥ë¨)`);
            }
        }

        function getRecommendedLinks(currentItem) {
            // Logic: Recommend up to 3 published posts from the SAME LEG
            return db.filter(d => 
                d.published && 
                d.id !== currentItem.id && 
                d.leg === currentItem.leg 
            ).slice(0, 3);
        }

        // --- 3. UI RENDERING ---

        // View Switcher
        function switchView(viewId) {
            ['dashboard', 'library', 'link-master'].forEach(v => {
                document.getElementById(`${v}-view`).classList.add('hidden');
            });
            document.getElementById(`${viewId}-view`).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // Render Grid
        function renderContentGrid() {
            const grid = document.getElementById('contentGrid');
            const filterLeg = document.querySelector('.filter-btn.ring-2')?.dataset.leg || 'all';
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            grid.innerHTML = '';

            const filtered = db.filter(item => {
                const legMatch = filterLeg === 'all' || item.leg === filterLeg;
                const textMatch = item.title.toLowerCase().includes(searchText) || item.keyword.toLowerCase().includes(searchText);
                return legMatch && textMatch;
            });

            filtered.forEach(item => {
                const colors = {
                    'Traffic': 'border-amber-200 hover:border-amber-400 bg-amber-50/30',
                    'Debt': 'border-indigo-200 hover:border-indigo-400 bg-indigo-50/30',
                    'Housing': 'border-emerald-200 hover:border-emerald-400 bg-emerald-50/30',
                    'Crime': 'border-rose-200 hover:border-rose-400 bg-rose-50/30'
                };
                
                const statusBadge = item.published 
                    ? `<span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded-full"><i class="fa-solid fa-check"></i> ë°œí–‰ë¨</span>`
                    : `<span class="bg-slate-100 text-slate-500 text-xs font-bold px-2 py-1 rounded-full">ì‘ì„± ì „</span>`;

                const copyText = `${item.title}`; // The formatted string requested

                const card = document.createElement('div');
                card.className = `bg-white p-5 rounded-xl border ${colors[item.leg]} card-shadow transition-all duration-300 hover:shadow-lg group relative`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-xs font-bold px-2 py-1 rounded bg-white border border-slate-200 text-slate-600 uppercase">${item.leg}</span>
                        ${statusBadge}
                    </div>
                    <h3 class="font-bold text-slate-800 mb-2 leading-snug group-hover:text-indigo-700 cursor-pointer text-base md:text-lg" onclick="openModal(${item.id})">${item.title.split('///')[0]}</h3>
                    <div class="flex justify-between items-end mt-4">
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">ğŸ”‘ ${item.keyword}</span>
                        <button onclick="copyToClipboard('${copyText}', true)" class="text-xs bg-white border border-slate-200 hover:bg-slate-50 text-slate-500 font-bold px-2 py-1 rounded shadow-sm">
                            <i class="fa-regular fa-copy"></i> ë³µì‚¬
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Render Select Options for Publishing
        function renderSelectOptions() {
            const select = document.getElementById('pubSelect');
            // Clear except first
            select.innerHTML = '<option value="">1. ë°œí–‰í•œ ê¸€ ì„ íƒ (ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²€ìƒ‰)</option>';
            
            // Sort by ID to keep order
            db.forEach(item => {
                if (!item.published) {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `[${item.leg}] ${item.keyword} - ${item.title.substring(0, 30)}...`;
                    select.appendChild(option);
                }
            });
        }

        // Update Published List Sidebar
        function updatePublishedList() {
            const list = document.getElementById('publishedList');
            const countSpan = document.getElementById('pubCount');
            const publishedItems = db.filter(d => d.published);
            
            countSpan.textContent = publishedItems.length;
            
            if (publishedItems.length === 0) {
                list.innerHTML = `<div class="text-center text-slate-400 mt-10"><i class="fa-regular fa-folder-open text-4xl mb-2"></i><p>ì•„ì§ ë°œí–‰ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ìœ„ ì½˜ì†”ì—ì„œ ë“±ë¡í•´ ì£¼ì„¸ìš”.</p></div>`;
                return;
            }

            list.innerHTML = '';
            publishedItems.forEach(item => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-3 bg-slate-50 rounded border border-slate-200 text-sm";
                div.innerHTML = `
                    <div class="truncate w-4/5">
                        <span class="font-bold text-indigo-600">[${item.leg}]</span> ${item.keyword}
                        <div class="text-xs text-slate-400 truncate">${item.url}</div>
                    </div>
                    <a href="https://${item.url}" target="_blank" class="text-slate-400 hover:text-indigo-500"><i class="fa-solid fa-external-link"></i></a>
                `;
                list.appendChild(div);
            });
        }

        // --- 4. CHARTS ---
        function renderCharts() {
            // Sunburst
            const data = [{
                type: "sunburst",
                labels: ["Law Gear", "Traffic", "Debt", "Housing", "Crime", ...db.map(d => `${d.leg}-${d.id}`)], 
                parents: ["", "Law Gear", "Law Gear", "Law Gear", "Law Gear", ...db.map(d => d.leg)],
                values: [160, 40, 40, 40, 40, ...db.map(() => 1)],
                outsidetextfont: {size: 14, color: "#377eb8"},
                leaf: {opacity: 0.4},
                marker: {line: {width: 2}},
                branchvalues: 'total'
            }];
            // For stability in this demo code, simplifying the sunburst to just Levels 1 & 2
            const simpleData = [{
                type: "sunburst",
                labels: ["Law Gear", "Traffic", "Debt", "Housing", "Crime"],
                parents: ["", "Law Gear", "Law Gear", "Law Gear", "Law Gear"],
                values: [160, 40, 40, 40, 40],
                outsidetextfont: {size: 16, color: "#fff"},
                marker: {colors: ["#1e293b", "#f59e0b", "#4f46e5", "#10b981", "#f43f5e"]}
            }];
            Plotly.newPlot('sunburstChart', simpleData, {margin: {l:0, r:0, b:0, t:0}}, {responsive: true});

            // Radar
            const ctx = document.getElementById('radarChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ìˆ˜ìµì„±', 'ì ‘ê·¼ì„±', 'ê¸´ê¸‰ì„±', 'í™•ì¥ì„±', 'ë‚œì´ë„'],
                    datasets: [
                        { label: 'Traffic', data: [4,5,4,5,2], borderColor: '#f59e0b', backgroundColor: 'rgba(245,158,11,0.2)' },
                        { label: 'Debt', data: [5,3,5,4,4], borderColor: '#4f46e5', backgroundColor: 'rgba(79,70,229,0.2)' },
                        { label: 'Housing', data: [3,5,3,4,2], borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.2)' },
                        { label: 'Crime', data: [2,4,5,3,3], borderColor: '#f43f5e', backgroundColor: 'rgba(244,63,94,0.2)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function renderNetworkGraph() {
            // Plotly Network Graph Logic
            // Nodes: 4 Centers + Published Posts
            const published = db.filter(d => d.published);
            
            // Simple visualization: Just scatter plot for now as true network needs complex parsing
            // X axis: Leg Category (0, 1, 2, 3), Y axis: Random
            const trace = {
                x: published.map(d => {
                    if(d.leg==='Traffic') return 1;
                    if(d.leg==='Debt') return 2;
                    if(d.leg==='Housing') return 3;
                    return 4;
                }),
                y: published.map(() => Math.random() * 10),
                mode: 'markers+text',
                type: 'scatter',
                text: published.map(d => d.keyword),
                textposition: 'top center',
                marker: { size: 12, color: published.map(d => {
                    if(d.leg==='Traffic') return '#f59e0b';
                    if(d.leg==='Debt') return '#4f46e5';
                    if(d.leg==='Housing') return '#10b981';
                    return '#f43f5e';
                }) }
            };
            
            const layout = {
                title: 'ë°œí–‰ëœ ê¸€ ë¶„í¬ë„ (ì¹´í…Œê³ ë¦¬ë³„)',
                xaxis: { title: 'Category Group', showgrid: false, zeroline: false, tickvals: [1,2,3,4], ticktext: ['Traffic', 'Debt', 'Housing', 'Crime'] },
                yaxis: { showgrid: false, zeroline: false, showticklabels: false },
                hovermode: 'closest'
            };
            
            Plotly.newPlot('networkChart', [trace], layout, {responsive: true});
        }

        // --- 5. MODAL & UTILS ---
        function openModal(id) {
            const item = db.find(d => d.id === id);
            if (!item) return;

            // Populate Content
            document.getElementById('m-leg').innerText = item.leg;
            document.getElementById('m-title').innerText = item.title.split('///')[0];
            document.getElementById('m-copy-text').innerText = item.title; // Full string for copy
            document.getElementById('m-keyword').innerText = item.keyword;
            document.getElementById('m-hook').innerText = `"${item.hook}"`;
            document.getElementById('m-body').innerText = item.body;
            
            // SEO Tags
            const seoContainer = document.getElementById('m-seo');
            seoContainer.innerHTML = item.seo.split(',').map(s => `<span class="bg-slate-100 px-2 py-1 rounded text-xs text-slate-600">#${s.trim()}</span>`).join('');
            
            document.getElementById('m-cpa').innerText = item.cpa;

            // Internal Link Recommendation
            const recLinks = getRecommendedLinks(item);
            const recContainer = document.getElementById('m-link-recommendation');
            const recList = document.getElementById('m-link-list');
            
            if (recLinks.length > 0) {
                recContainer.classList.remove('hidden');
                recList.innerHTML = recLinks.map(l => `<li>ğŸ”— <a href="https://${l.url}" target="_blank" class="underline hover:text-indigo-900">${l.keyword}</a> (ì´ë¯¸ ë°œí–‰ë¨)</li>`).join('');
            } else {
                recContainer.classList.add('hidden');
            }

            // Status
            const statusEl = document.getElementById('m-status');
            if (item.published) {
                statusEl.innerHTML = `<span class="text-blue-600"><i class="fa-solid fa-check-circle"></i> ë°œí–‰ ì™„ë£Œ (${item.url})</span>`;
            } else {
                statusEl.innerHTML = `STATUS: ì‘ì„± ì˜ˆì • (DRAFT)`;
            }

            // Show
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modalContent');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function copyToClipboard(textOrId, isDirectText = false) {
            let text;
            if (isDirectText) {
                text = textOrId;
            } else {
                text = document.getElementById(textOrId).innerText;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                alert(`ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤:\n${text}`);
            });
        }

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            loadFromStorage(); // Load saved data first
            renderCharts();
            renderContentGrid();
            renderSelectOptions();
            renderNetworkGraph(); // Initial graph with loaded data
            updatePublishedList();

            // Search Filter
            document.getElementById('searchInput').addEventListener('input', renderContentGrid);
            
            // Leg Buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    // Reset all rings
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('ring-2', 'ring-offset-2', 'ring-slate-400'));
                    // Add ring to active
                    e.target.classList.add('ring-2', 'ring-offset-2', 'ring-slate-400');
                    renderContentGrid();
                });
            });
            // Set All as default active
            document.querySelector('.filter-btn[data-leg="all"]').click();
        });

    </script>
</body>
</html>
